% Diagram for the Anduril 2 user interface for flashlights
% Copyright (C) 2024-2025 Guido dirtydancing
% SPDX-License-Identifier: GPL-3.0-or-later

\documentclass[8pt]{extarticle}
% \documentclass[10pt]{article} % default font size: 10pt

\usepackage[
    a4paper,
    landscape
]
{geometry}

% \PassOptionsToPackage{gray}{xcolor} % for grayscale output

% \usepackage[dvipsnames]{xcolor} % for additional color names

\usepackage{fontspec}
\setmainfont{Source Sans 3}

\usepackage{setspace} % for setting the spacing between lines
\setstretch{0.9}

\usepackage{array} % for table fixed width

\usepackage{makecell} % for line breaks within table cells
\renewcommand\cellalign{tl}
% for makecell package: vertical top, horizontal left for cells
\renewcommand\cellgape{\Gape[0.35ex]}
% for makecell package: vertical spaces around cells
\renewcommand\theadalign{tl}
% for makecell package: vertical top, horizontal left for column heads
\renewcommand\theadgape{\Gape[0.5ex]}
% for makecell package: vertical spaces around column heads
\renewcommand\theadfont{\bfseries\normalsize}
% for makecell package: default font size for column heads

\setlength{\tabcolsep}{0pt} % default: 6pt

\usepackage{tcolorbox} % for colored and framed text boxes

\newtcbox{\voltageboxred}{
    colframe=white, % initially black!75!white
    opacityframe=0, % initially 1.0
    boxrule=0cm, % initially 0.05cm
    colback=red!25, % initially black!5!white
    coltext=black, % initially black
    left=0.02cm, % initially 0.4cm
    right=0cm, % initially 0.4cm
    top=0cm, % initially 0.2cm
    bottom=0cm, % initially 0.2cm
    boxsep=0cm, % initially 0.1cm
    arc=0.05cm, % initially 0.1cm
    sharp corners=east, % initially all rounded corners
    box align=base % initially bottom
}
\newtcbox{\voltagebox}[1][white]{
    colframe=white,
    opacityframe=0,
    boxrule=0cm,
    colback=#1!25,
    coltext=black,
    left=0cm,
    right=0cm,
    top=0cm,
    bottom=0cm,
    boxsep=0cm,
    sharp corners,
    box align=base
}
\newtcbox{\voltageboxpurple}{
    colframe=white,
    opacityframe=0,
    boxrule=0cm,
    colback=purple!25,
    coltext=black,
    left=0cm,
    right=0.02cm,
    top=0cm,
    bottom=0cm,
    boxsep=0cm,
    arc=0.05cm,
    sharp corners=west,
    box align=base
}

\usepackage{tikz}
\usetikzlibrary{arrows.meta} % for Stealth arrow tip
\usetikzlibrary{bending} % for flexing and bending arrows
% with bending library, default: flex
% without bending library, default: quick
\usetikzlibrary{positioning} % for relative positioning
\usetikzlibrary{shapes.misc} % for rounded rectangle
\usetikzlibrary{fit} % for fitting a node
\usetikzlibrary{backgrounds} % for background frames
\usetikzlibrary{decorations.text} % for text along path

\definecolor{cyan-1}{HTML}{3EFFEC}
\definecolor{yellow-1}{HTML}{FFEC30}
\definecolor{orange-1}{HTML}{FFA40F}
\definecolor{blue-1}{HTML}{0F5BE0}

\tikzset{
    >={
        Stealth[
            round,
            scale length=1.25,
            scale width=1.25
        ]
    }
}
\tikzset{
    rampstepped/.style={
        rectangle,
        draw=none,
        minimum width=0.75cm+0.3pt,
        minimum height=0.9cm+0.1pt,
        inner sep=0cm,
        outer sep=0cm
    },
    rampsmooth/.style={
        rampstepped,
        minimum width=0.75cm+0.3pt,
        minimum height=5.4cm+0.6pt % 5.4cm = 6 x 0.9cm
    },
    rampcombined/.style={
        rectangle,
        draw=black,
        thin, % thin = 0.4pt (default)
        fill=none,
        inner sep=0cm,
        minimum width=1.5cm+7.2pt,
        minimum height=5.4cm+7.2pt,
        rounded corners=0.25pt % default: 4pt
    },
    rampcombined inside 1/.style={
        rampcombined,
        draw=yellow-1!40,
        line width=3.2pt,
        minimum width=1.5cm+3.6pt,
        minimum height=5.4cm+3.6pt,
        rounded corners=0pt
    },
    rampcombined inside 2/.style={
        rampcombined,
        draw=gray,
        very nearly transparent,
        minimum width=1.5cm,
        minimum height=5.4cm,
        rounded corners=0pt
    },
    turbocombined/.style={
        rectangle,
        above=-0.41pt, % 0.01pt more than line thickness
        draw=black,
        thin,
        fill=white,
        inner sep=0cm,
        minimum width=1.5cm+7.2pt,
        minimum height=1.2cm,
        rounded corners=0.25pt
    }
}
\tikzset{
    anyline/.style={
        draw=black,
        thin
    },
    anyline basic use/.style={
        anyline
    },
     anyline ramp/.style={
        anyline,
        line cap=round
    },
    anyline momentary/.style={
        anyline,
        densely dashed,
        line cap=round
    },
    anybutton/.style={
        draw=black,
        thin,
        solid,
        fill=white,
        text=black,
        font=\normalsize,
        inner sep=0.075cm,
        rounded corners
    },
    anybutton basic use/.style={
        anybutton,
        ultra thick, % ultra thick = 1.6pt
        fill=cyan-1!35,
        font=\bfseries
    },
    anyconfig/.style={
        draw=black,
        thin,
        solid,
        fill=yellow-1!40,
        inner sep=0.1cm,
        rounded corners,
        align=left
    }
}
\tikzset{
    anyline-mode/.style={
        anyline
    },
    anybutton-mode/.style={
        anybutton
    },
    anyconfig-mode/.style={
        anyconfig,
        draw=blue-1!90,
        very thick % very thick = 1.2pt
    }
}
\tikzset{
    advancedline/.style={
        anyline
    },
     advancedline momentary/.style={
        advancedline,
        densely dashed,
        line cap=round
    },
    advancedbutton/.style={
        anybutton,
        draw=none
    },
     advancedconfig/.style={
        anyconfig,
        fill=gray!8
    },
    advancedfit/.style={
        advancedconfig,
        draw=blue-1!90,
        fill=none,
        inner sep=0.3cm
    },
    advancedtable/.style={
        advancedconfig
    },
    advancedUI/.style={
        advancedconfig,
        draw=red!80,
        very thick,
        font=\bfseries\LARGE
    }
}
\tikzset{
    advancedline-mode/.style={
        advancedline
    },
    advancedbutton-mode/.style={
        advancedbutton
    },
    advancedconfig-mode/.style={
        advancedconfig,
        draw=blue-1!90,
        very thick
    }
}
\tikzset{
    simpleline/.style={
        anyline
    },
    simpleline momentary/.style={
        anyline momentary
    },
    simplebutton/.style={
        anybutton,
        double
    },
    simpleUI/.style={
        anyconfig,
        draw=red!80,
        very thick,
        font=\bfseries\LARGE
    }
}
\tikzset{
    extendedsimpleline/.style={
        anyline
    },
    extendedsimplebutton/.style={
        anybutton
    },
    extendedsimpleconfig/.style={
        anyconfig,
        fill=orange-1!20
    },
    extendedsimplefit/.style={
        extendedsimpleconfig,
        draw=blue-1!90,
        fill=none,
        inner sep=0.3cm
    },
    extendedsimpleUI/.style={
        extendedsimpleconfig,
        fill=white
    }
}
\tikzset{
    extendedsimpleline-mode/.style={
        extendedsimpleline
    },
    extendedsimplebutton-mode/.style={
        extendedsimplebutton
    },
    extendedsimpleconfig-mode/.style={
        extendedsimpleconfig,
        draw=blue-1!90,
        very thick
    }
}
\tikzset{
    on-extra/.style={
        draw=black,
        thick, % thick = 0.8pt
        fill=white,
        text=black,
        font=\bfseries\normalsize,
        inner xsep=0.375cm,
        inner ysep=0.065cm,
        rounded rectangle
    },
    onoff/.style={
        on-extra,
        font=\bfseries\Huge,
        on grid
    }
}
\tikzset{
    generalinfo/.style={
        anyconfig,
        draw=gray,
        fill=white
    },
    thermalregulationinfo/.style={
        generalinfo
    },
    andurilinfo/.style={
        generalinfo
    },
    voltagecolorinfo/.style={
        generalinfo
    },
    buttonpressesinfo/.style={
        generalinfo
    }
}
\tikzset{
    legendlayout/.style={
        rectangle,
        draw=none,
        minimum width=0.808cm,
        minimum height=0.281cm,
        inner sep=0cm,
        outer sep=0cm,
        sharp corners,
        align=left
    },
    legendfit/.style={
        generalinfo
    }
}
\tikzset{
    anyline basic use legend/.style={
        anyline basic use,
        line cap=round
    },
    anyline legend/.style={
        anyline,
        line cap=round
    },
    simpleline legend/.style={
        simpleline,
        line cap=round
    },
    advancedline legend/.style={
        advancedline,
        line cap=round
    },
    anyline momentary legend/.style={
        anyline momentary,
        line cap=round
    }
}

\newcommand{\spacingv}{\\[0.75ex]}

\newcommand{\oneline}[1]{\bfseries\normalsize{#1}}
\newcommand{\firstline}[1]{\oneline{#1}\spacingv}

\newcommand{\onelinetable}[1]{\mdseries\footnotesize{#1}}
\newcommand{\firstlinetable}[1]{\onelinetable{#1}\\[-0.55ex]}

\newcommand{\inherited}{\char"002A}

\begin{document}

\thispagestyle{empty}

\begin{tikzpicture}[
    remember picture, % for referencing the current page node
    overlay, % for referencing the current page node
    font=\footnotesize
]

% tikzpicture - Table of Contents %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Ramp %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Lockout %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Momentary Mode from OFF ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Strobe / Mood Modes from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Tactical Mode from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Blinky / Utility Modes from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Next Channel Mode from ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Ramp Config from ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Simple UI Config from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Momentary Moon from Lockout %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Aux LED Color from OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Factory Reset from OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Advanced UI switch from OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Anduril 2 UI %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Ramp %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Ramp Smooth)
at (current page.center)[
    rampsmooth,
    anchor=east,
    top color=gray!0,
    bottom color=gray!50
]
{};
\node (Ramp Stepped 4)
at (current page.center)[
    rampstepped,
    anchor=north west,
    top color=gray!40,
    bottom color=gray!30
]
{};
\node (Ramp Stepped 5)[
    rampstepped,
    below=0cm of Ramp Stepped 4.south,
    anchor=north,
    top color=gray!50,
    bottom color=gray!40
]
{};
\node (Ramp Stepped 6)[
    rampstepped,
    below=0cm of Ramp Stepped 5.south,
    anchor=north,
    top color=gray!60,
    bottom color=gray!50
]
{};
\node (Ramp Stepped 3)[
    rampstepped,
    above=0cm of Ramp Stepped 4.north,
    anchor=south,
    top color=gray!30,
    bottom color=gray!20
]
{};
\node (Ramp Stepped 2)[
    rampstepped,
    above=0cm of Ramp Stepped 3.north,
    anchor=south,
    top color=gray!20,
    bottom color=gray!10
]
{};
\node (Ramp Stepped 1)[
    rampstepped,
    above=0cm of Ramp Stepped 2.north,
    anchor=south,
    top color=gray!10,
    bottom color=gray!0
]
{};

\node (Ramp)
at (current page.center)[
    rampcombined
]
{};
\node (Ramp 0pt)
at (current page.center)[
    rampcombined,
    draw=none,
    line width=0pt
]
{};
\node (Ramp inside 1)
at (current page.center)[
    rampcombined inside 1
]
{};
\node (Ramp inside 2)
at (current page.center)[
    rampcombined inside 2
]
{};

\node (ON Ramp) at (Ramp.center)[
    onoff,
    inner xsep=0.225cm
]
{ON};
\node (Ramp Memory) at (ON Ramp.south)[below]{\oneline{Memory}};
\node (Ramp Ceiling) at (Ramp.north)[
    below,
    yshift=-3.2pt % -3.2pt for Ramp inside 1
]
{\oneline{Ceiling}};
\node (Ramp Floor) at (Ramp.south)[
    above,
    yshift=3.2pt % +3.2pt for Ramp inside 1
]
{\oneline{Floor}};
\node (Ramp Style Smooth)[
    below right=0.05cm and 0.36cm of Ramp.south west,
    anchor=north,
    align=center
]
{Smooth};
\node (Ramp Style Stepped)[
    below left=0.05cm and 0.36cm+0.02cm of Ramp.south east, % +0.02cm
    % for vertical alignment
    anchor=north,
    align=center
]
{Stepped};
\node (Ramp Styles fit)[
    inner sep=-0.05cm,
    fit=(Ramp Style Smooth) (Ramp Style Stepped)
]
{};

\draw (ON Ramp.north) edge[
    arrows={<[open, fill=white]->},
    anyline basic use,
    yshift=0.15cm
]
node[
    anybutton basic use,
    pos=0.5,
    label={
        [align=left, xshift=0.57cm, yshift=-0.025cm]right:{
            \begin{tabular}{l}
                Ramp up\\
                (floor\textendash{}ceiling),\\
                with reversal\\
                if released\\
                and held again\\
                within 1s
            \end{tabular}
        }
    }
]
{1H} (Ramp Ceiling.south);
\draw (Ramp Memory.south) edge[
    arrows={->},
    anyline ramp
]
node[
    anybutton,
    pos=0.42,
    label={
        [align=left, xshift=0.57cm+0.8pt, % +0.8pt for vertical alignment
        yshift=-0.025cm]right:{
            \begin{tabular}{l}
                Ramp down\\
                (ceiling\textendash{}floor)
            \end{tabular}
        }
    }
]
{2H} (Ramp Floor.north);

% Turbo
\begin{scope}[on background layer]
    \node (Turbo)[
        turbocombined
    ]
    at (Ramp.north){};
    \node (Turbo text)[
        below,
        fill=none
    ]
    at (Turbo.north) {\oneline{Turbo}};
    \node (Ramp label)[
        on-extra,
        inner xsep=0.425cm,
        above,
        yshift=0.15cm
    ]
    at (Turbo.north) {R\hspace{0.1em}A\hspace{0.1em}M\hspace{0.1em}P};

    \node (Turbo 0pt)[
        turbocombined,
        above=0pt,
        draw=none,
        fill=none,
        line width=0pt
    ]
    at (Ramp 0pt.north){};
\end{scope}

% Thermal Regulation
\node (Thermal Regulation)[
    thermalregulationinfo,
    above=0.2cm of Ramp label.north,
    anchor=south
]
{
    \firstline{Thermal Regulation}
    Only present in continuous\\
    ramp mode (floor\textendash{}turbo)
};

% Toggle Ramp Style from ON
\node (Toggle Ramp Style from ON)[
    advancedconfig,
    below=0.8cm of Ramp.south,
    anchor=north,
    align=center
]
{\oneline{Toggle Ramp Style\inherited{}}};
\node (Toggle Ramp Style extra node ON)[
    on-extra,
    below right=0.9cm and 0.2cm of Toggle Ramp Style from ON.west,
    anchor=center
]
{ON};

\draw (Toggle Ramp Style extra node ON.east) edge[
    ->,
    advancedline,
    out=0,
    in=270,
    out looseness=0.8,
    in looseness=1.8
]
node[
    advancedbutton,
    pos=0.6,
    label={
        [align=left, xshift=-0.05cm, yshift=-0.025cm]right:{
            \begin{tabular}{l}
                3C if only one\\
                channel mode
            \end{tabular}
        }
    }
]
{6C}(Toggle Ramp Style from ON.south);
\draw (Toggle Ramp Style from ON.north) edge[
    ->,
    advancedline,
    out=90,
    in=225,
    out looseness=0.5,
    in looseness=2
]
(Ramp Styles fit.335);
\draw (Toggle Ramp Style from ON.north) edge[
    ->,
    advancedline,
    out=90,
    in=315,
    out looseness=0.5,
    in looseness=2
]
(Ramp Styles fit.205);

% OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (OFF)[
    onoff,
    left=3.8cm of Ramp
]
{OFF};

\draw (OFF.north) edge[
    ->,
    advancedline momentary,
    shorten >=0.2pt,
    out=90,
    in=180,
    looseness=1.4
]
node[
    advancedbutton,
    pos=0.808
]
{2H} (Turbo 0pt.north west);
\draw (OFF.north) edge[
    ->,
    anyline,
    shorten >=0.2pt,
    out=90,
    in=180,
    looseness=1.3
]
node[
    anybutton,
    pos=0.7,
]
{2C}
(Ramp 0pt.north west);
\draw (OFF.north east) edge[
    -, % no extra arrow tip
    simpleline momentary,
    shorten >=2.5pt,
    out=90,
    in=180,
    out looseness=1.3,
    in looseness=0.65
]
node[
    simplebutton,
    pos=0.18
]
{2H} (Ramp 0pt.north west);

% Advanced UI: Anduril 2 turbo style
\draw (Ramp 0pt.north) edge[
    {Round Cap[sep=0.7cm]}-{Round Cap[sep=2.3cm]},
    advancedline,
    white,
    line width=2.4pt,
    shorten >=0.2pt,
    shorten <=0.6pt,
    out=40,
    in=0,
    out looseness=0.3,
    in looseness=3
]
node
{} (Turbo 0pt.north east);
\draw (Ramp 0pt.north) edge[
    <->,
    advancedline,
    shorten >=0.2pt,
    shorten <=0.6pt,
    out=40,
    in=0,
    out looseness=0.3,
    in looseness=3
]
node[
    advancedbutton,
    pos=0.6,
    label={
        [align=left, xshift=-0.05cm, yshift=-0.025cm]right:{
            \begin{tabular}{l}
                If ramped up\\
                to ceiling first
            \end{tabular}
        }
    }
]
{2C} (Turbo 0pt.north east);

\draw (Ramp 0pt.west) edge[
    {<[scale width=0.75]->[scale width=0.75]},
    anyline,
    shorten >=0.4pt,
    shorten <=0.4pt,
    bend left=37
]
node[
    anybutton,
    pos=0.5
]
{2C} (Ramp 0pt.north west);

\draw (OFF.south) edge[
    ->,
    anyline,
    shorten >=0.2pt,
    out=270,
    in=180,
    looseness=1.3
]
node[
    anybutton,
    pos=0.7
]
{1H} (Ramp 0pt.south west);
\draw (OFF.east) edge[
    <->,
    anyline basic use,
    shorten >=0.2pt
]
node[
    anybutton basic use,
    pos=0.5
]
{1C} (Ramp 0pt.west);

% Lockout %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Lockout)[
    onoff,
    right=3.8cm of Ramp
]
{LOCK\footnotesize OUT};

\draw (Lockout.north) edge[
    ->,
    anyline,
    shorten >=0.2pt,
    out=90,
    in=0,
    looseness=1.3
]
node[
    anybutton,
    pos=0.7
]
{5C} (Ramp 0pt.north east);
\draw (Lockout.south) edge[
    ->,
    anyline,
    shorten >=0.2pt,
    out=270,
    in=0,
    looseness=1.3
]
node[
    anybutton,
    pos=0.7
]
{4H} (Ramp 0pt.south east);
\draw (Lockout.west) edge[
    <->,
    anyline,
    shorten >=0.2pt
]
node[
    anybutton,
    pos=0.5
]
{4C} (Ramp 0pt.east);

% ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (ON)[
    onoff,
    left=4.4cm of OFF
]
{ON};

\draw (ON.east) edge[
    <->,
    anyline
]
node[
    anybutton,
    pos=0.5
]
{1C} (OFF.west);

% OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (OFF right)[
    onoff,
    right=6.4cm of Lockout
]
{OFF};

\draw (Lockout.east) edge[
    <->,
    anyline
]
node[
    anybutton,
    pos=0.4,
    label={
        [align=center, xshift=0cm, yshift=-0.1cm]above:{
        \normalsize \char"2192{}
        }
    }
]
{3C}
node[
    anybutton,
    pos=0.6,
    label={
        [align=center, xshift=0cm, yshift=0.1cm]below:{
        \normalsize \char"2190{}
        }
    }
]
{4C} (OFF right.west);

\node (OFF right extra node ON)[
    on-extra,
    below left=0.75cm and 1.1cm of OFF right.west,
    anchor=center
]
{ON};

\draw (OFF right extra node ON.east) edge[
    <->,
    anyline,
    out=0,
    in=270,
    looseness=1
]
node[
    anybutton,
    pos=0.45
]
{1C} (OFF right.210);

% Momentary Mode from OFF ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Momentary Mode from OFF ON)[
    advancedconfig,
    below left=1.2cm and 2.2cm of OFF.center,
    anchor=north
]
{
    \firstline{Momentary Mode}
    \textbf{Exit: disconnect power}
};

\draw (OFF.south) edge[
    ->,
    advancedline,
    out=270,
    in=0,
    looseness=1
]
node[
    advancedbutton,
    pos=0.65
]
{5C} (Momentary Mode from OFF ON.east);
\draw (ON.south) edge[
    ->,
    advancedline,
    out=270,
    in=180,
    looseness=1
]
node[
    advancedbutton,
    pos=0.65
]
{5C} (Momentary Mode from OFF ON.west);

% Strobe / Mood Modes from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Lightning Storm from Police Strobe
\node (Lightning Storm from Police Strobe)
at (current page.south west)[ 
    advancedconfig-mode,
    xshift=1.3cm,
    yshift=5.15cm,
    anchor=south west
]
{\oneline{Lightning Storm}};

% Police Strobe from Tactical Strobe
\node (Police Strobe from Tactical Strobe)[
    advancedconfig-mode,
    below=0.8cm of Lightning Storm from Police Strobe.south,
    anchor=north
]
{\oneline{Police Strobe}};

\draw (Police Strobe from Tactical Strobe.north) edge[
    ->,
    advancedline-mode,
    out=90,
    in=270,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.4
]
{2C} (Lightning Storm from Police Strobe.south);

% Tactical Strobe from Party Strobe
\node (Tactical Strobe from Party Strobe)[
    advancedconfig-mode,
    below=0.8cm of Police Strobe from Tactical Strobe.south,
    anchor=north
]
{\oneline{Tactical Strobe}};

\draw (Tactical Strobe from Party Strobe.north) edge[
    ->,
    advancedline-mode,
    out=90,
    in=270,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.4
]
{2C} (Police Strobe from Tactical Strobe.south);

% Party Strobe from Bike Flasher
\node (Party Strobe from Bike Flasher)[
    advancedconfig-mode,
    below=0.8cm of Tactical Strobe from Party Strobe.south,
    anchor=north
]
{\oneline{Party Strobe}};

\draw (Party Strobe from Bike Flasher.north) edge[
    ->,
    advancedline-mode,
    out=90,
    in=270,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.4
]
{2C} (Tactical Strobe from Party Strobe.south);

% Candle from OFF
\node (Candle from OFF)[
    advancedconfig-mode,
    above right=0.55cm and 1.3cm of Lightning Storm from Police Strobe.east,
    anchor=west
]
{\oneline{Candle}};

\draw (Lightning Storm from Police Strobe.east) edge[
    ->,
    advancedline-mode,
    out=0,
    in=180,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.4
]
{2C} (Candle from OFF.west);

% Candle Timer
\node (Candle Timer)[
    advancedconfig,
    above left=0.5cm and 1cm of Candle from OFF.west,
    anchor=east
]
{
    \firstline{Candle Timer}
    1 blink = 5 minutes
};

\draw (Candle from OFF.north west) edge[
    ->,
    advancedline,
    shorten <=-1.9pt,
    out=135,
    in=0,
    looseness=0.7
]
node[
    advancedbutton,
    pos=0.45
]
{5H} (Candle Timer.east);

% Bike Flasher from Candle
\node (Bike Flasher from Candle)[
    advancedconfig-mode,
    below=0.8cm of Candle from OFF.south,
    anchor=north
]
{\oneline{Bike Flasher}};

\draw (Candle from OFF.south) edge[
    ->,
    advancedline-mode,
    out=270,
    in=90,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.4
]
{2C} (Bike Flasher from Candle.north);

\draw (Bike Flasher from Candle.west) edge[
    ->,
    advancedline-mode,
    out=180,
    in=20,
    looseness=0.7
]
node[
    advancedbutton-mode,
    pos=0.49
]
{2C} (Party Strobe from Bike Flasher.east);

% Strobe / Mood Modes Actions
\node (Strobe Modes Actions)
at (current page.south)[
    advancedconfig,
    xshift=-7.9cm,
    yshift=1.3cm,
    anchor=south east
]
{
    \firstline{Actions}
    1H/2H = Brighter/dimmer\\
    (Candle and Bike)\\
    1H/2H = Faster/slower\\
    (Party and Tactical)\\
    3C = Next channel mode\\
    (except Police),\\
    saved per strobe mode\\
    4C = Previous strobe mode\vphantom{y}
};

% Strobe Modes fit
\begin{scope}[on background layer]
    \node (Strobe Modes fit)[
        advancedfit,
        xshift=0.2pt, % 1/2 line thickness for outer alignment
        yshift=0.2pt, % 1/2 line thickness for outer alignment
        fit=(Candle from OFF)
        (Candle Timer)
        (Bike Flasher from Candle)
        (Party Strobe from Bike Flasher)
        (Tactical Strobe from Party Strobe)
        (Police Strobe from Tactical Strobe)
        (Lightning Storm from Police Strobe)
        (Strobe Modes Actions)
    ]
    {};
    \node (Strobe Modes fit title)[
        below=0cm of Strobe Modes fit.north east,
        anchor=north east,
        inner xsep=0.15cm,
        inner ysep=0.1cm,
        align=right
    ]
    {
        \normalsize\textbf{Strobe / Mood Modes}
        \spacingv
        1C = Off
    };
\end{scope}

\draw (OFF.south) edge[
    ->,
    advancedline,
    out=270,
    in=0,
    looseness=1.3,
    postaction={
        decoration={
            text along path,
            text={|\footnotesize|Mode memory},
            reverse path,
            text align={left indent=0.65cm},
            raise=0.08cm
        },
        decorate
    }
]
node[
    advancedbutton,
    pos=0.55
]
{3H} (Strobe Modes fit.42);
\draw (Strobe Modes fit.60) edge[
    ->,
    advancedline,
    out=90,
    in=180,
    looseness=1
]
node[
    advancedbutton,
    pos=0.3,
    label={
        [align=left, xshift=-0.05cm, yshift=-0.025cm]right:{
            \begin{tabular}{l}
                Momentary\\
                Strobe Mode
            \end{tabular}
        }
   }
]
{5C}(Momentary Mode from OFF ON.191);

% Tactical Mode from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Tactical Mode Config
\node (Tactical Mode Config)
at (current page.south)[
    advancedtable,
    xshift=-6.8cm,
    yshift=1cm,
    anchor=south west
]
{
    \begin{tabular}{m{0.45cm} l}
        \multicolumn{2}{l}{
            \thead{Tactical Mode Config}
        }\\
        {1\textendash{}3} & \makecell{
            Tactical Slots 1\textendash{}3
        }\\
        {} & \makecell{
            1\textendash{}150C = Brightness\\
            0C = Last-used strobe /\\
            mood mode\\
            151C = Party strobe\\
            152C = Tactical strobe\\
            153+C = Other strobes
        }
    \end{tabular}
};

% Tactical Mode from OFF
\node (Tactical Mode from OFF)[
    advancedconfig,
    above=0.8cm of Tactical Mode Config.north,
    anchor=south
]
{
    \firstline{Tactical Mode}
    1H = Tactical Slot 1 (high)\\
    2H = Tactical Slot 2 (low)\\
    3H = Tactical Slot 3 (strobe)
};

\draw (Tactical Mode from OFF.south) edge[
    ->,
    advancedline,
    out=270,
    in=90,
    looseness=1
]
node[
    advancedbutton,
    pos=0.4
]
{7H} (Tactical Mode Config.north);
\draw (OFF.south) edge[
    -{<[sep=1.75cm]>},
    advancedline,
    out=270,
    in=60,
    looseness=1
]
node[
    advancedbutton,
    pos=0.82
]
{6C} (Tactical Mode from OFF.50);

% Tactical Mode extra node Aux LED
\node (Tactical Mode extra node Aux LED)[
    above=0.05cm of Tactical Mode from OFF.north west,
    anchor=south west,
    inner xsep=0.05cm,
    inner ysep=0cm,
    align=left
]
{
    Lockout mode's\\
    aux LED settings
};

% Blinky / Utility Modes from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Next Channel Mode from Batt Check
\node (Next Channel Mode from Batt Check)
at (current page.south)[
    advancedconfig,
    xshift=1.3cm,
    yshift=1.3cm,
    anchor=south west
]
{
    \firstline{Next Channel Mode\inherited{}}
    For number blinks only
};

% Batt Check from OFF
\node (Batt Check from OFF)[
    anyconfig-mode,
    above left=1.62 and 0.45cm of
    Next Channel Mode from Batt Check.north west,
    anchor=south west
]
{
    \firstline{Batt Check}
    0.02V steps
};

% Batt Check Simple Advanced
\node (Batt Check Simple Advanced)[
    above=0.05cm of Batt Check from OFF.north west,
    anchor=south west,
    inner xsep=0.05cm,
    inner ysep=0cm,
    align=left
]
{
    \textbf{Simple UI: voltage displayed once}\\
    \textbf{Advanced UI: voltage displayed continuously}
};

\draw (Batt Check from OFF.213) edge[
    ->,
    advancedline,
    shorten >=-1.8pt,
    out=270,
    in=120,
    looseness=1
]
node[
    advancedbutton,
    pos=0.5
]
{3C} (Next Channel Mode from Batt Check.north west);

\draw (OFF.south) edge[
    {Round Cap[sep=7.1cm]}-{Round Cap[sep=2.9cm]},
    anyline,
    white,
    line width=2.4pt,
    out=270,
    in=165,
    looseness=1.3
]
node
{} (Batt Check from OFF.172);
\draw (OFF.south) edge[
    ->,
    anyline,
    out=270,
    in=165,
    looseness=1.3
]
node[
    anybutton,
    pos=0.45
]
{3C} (Batt Check from OFF.172);

% Voltage Config from Batt Check
\begin{scope}[on background layer]
    \node (Voltage Config from Batt Check)[
        advancedtable,
        above right=0.4cm and 1.55cm of Tactical Mode Config.south east,
        anchor=south west
    ]
    {
        \begin{tabular}{m{0.35cm} l}
            \multicolumn{2}{l}{
                \thead{Voltage Config\inherited{}}
            }\\
            {1} & \makecell{
                Correction Factor
            }\\
            {} & \makecell{
                \char"00B1{}0.30V, 0.05V steps\\
                1C = \char"2212{}0.30V\\
                7C = 0V (default)\\
                13C = +0.30V
            }\\
            {2} & \makecell{
                \voltageboxred{Po\vphantom{Post-Off Display}}%
                \voltagebox[yellow]{st-\vphantom{Post-Off Display}}%
                \voltagebox[green]{Off\vphantom{Post-Off Display}}%
                \voltagebox[cyan]{\nobreakspace Di\vphantom{Post-Off Display}}%
                \voltagebox[blue]{spl\vphantom{Post-Off Display}}%
                \voltageboxpurple{ay\vphantom{Post-Off Display}}
            }\\
            {} & \makecell{
                0C = Disable\\
                nC = n seconds
            }
        \end{tabular}
    };
\end{scope}

\draw (Batt Check from OFF.197) edge[
    ->,
    advancedline,
    out=180,
    in=30,
    looseness=1
]
node[
    advancedbutton,
    pos=0.5
]
{7H} (Voltage Config from Batt Check.east);

% Temp Check from Batt Check
\node (Temp Check from Batt Check)[
    advancedconfig-mode,
    below right=0.2cm and 1.6cm of Batt Check from OFF.east,
    anchor=west
]
{\oneline{Temp Check}};

\draw (Batt Check from OFF.east) edge[
    ->,
    advancedline-mode,
    out=0,
    in=180,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.5
]
{2C} (Temp Check from Batt Check.west);

% Temp Check Thermal Config
\node (Temp Check Thermal Config)[
    advancedtable,
    above right=0.2cm and 1cm of Temp Check from Batt Check.north east,
    anchor=north west
]
{
    \begin{tabular}{m{0.35cm} l}
        \multicolumn{2}{l}{
            \thead{Thermal Config\inherited{}}
        }\\
        {1} & \makecell{
            Calibrate
        }\\
        {} & \makecell{
            nC = n\,°C
        }\\
        {2} & \makecell{
            Limit
        }\\
        {} & \makecell{
            nC = n + 30\,°C
        }
    \end{tabular}
};

\draw (Temp Check from Batt Check.east) edge[
    ->,
    advancedline,
    out=0,
    in=180,
    looseness=1
]
node[
    advancedbutton,
    pos=0.4
]
{7H} (Temp Check Thermal Config.west);

% Beacon from Temp Check
\node (Beacon from Temp Check)[
    advancedconfig-mode,
    below left=1cm and 0cm of Temp Check from Batt Check.south,
    anchor=north
]
{\oneline{Beacon}};

\draw (Temp Check from Batt Check.south) edge[
    ->,
    advancedline-mode,
    out=270,
    in=90,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.4
]
{2C} (Beacon from Temp Check.north);

% Beacon Speed
\node (Beacon Speed)[
    advancedconfig,
    below right=0.68cm and 1cm of Beacon from Temp Check.east,
    anchor=west
]
{
    \firstline{Beacon Speed}
    1 blink = 1 second pause
};

\draw (Beacon from Temp Check.east) edge[
    ->,
    advancedline,
    out=0,
    in=180,
    looseness=1
]
node[
    advancedbutton,
    pos=0.4
]
{1H} (Beacon Speed.west);

% SOS from Beacon
\node (SOS from Beacon)[
    advancedconfig-mode,
    above left=0.2cm and 1.8cm of Beacon from Temp Check.west,
    anchor=east
]
{\oneline{SOS}};

\draw (Beacon from Temp Check.west) edge[
    ->,
    advancedline-mode,
    out=180,
    in=0,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.5
]
{2C} (SOS from Beacon.east);
\draw (SOS from Beacon.north) edge[
    ->,
    advancedline-mode,
    out=90,
    in=270,
    looseness=1
]
node[
    advancedbutton-mode,
    pos=0.4
]
{2C} (Batt Check from OFF.south);

% Blinky Modes fit
\begin{scope}[on background layer]
    \node (Blinky Modes fit)[
        advancedfit,
        yshift=0.2pt, % 1/2 line thickness for outer alignment
        fit=(Batt Check from OFF)
        (Batt Check Simple Advanced)
        (Voltage Config from Batt Check)
        (Next Channel Mode from Batt Check)
        (Temp Check from Batt Check)
        (Temp Check Thermal Config)
        (Beacon from Temp Check)
        (Beacon Speed)
        (SOS from Beacon)
    ]
    {};
    \node (Blinky Modes fit title)[
        below=0cm of Blinky Modes fit.north east,
        anchor=north east,
        inner xsep=0.15cm,
        inner ysep=0.1cm,
        align=left
    ]
    {
        \normalsize\textbf{Blinky / Utility Modes}
        \spacingv
        1C = Off
    };
\end{scope}

% Next Channel Mode from ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Next Channel Mode from ON)
at (current page.west)[
    anyconfig,
    anchor=west,
    xshift=1cm,
    yshift=0.4cm
]
{\oneline{Next Channel Mode}};

\draw (ON.west) edge[
    ->,
    anyline,
    out=180,
    in=0,
    looseness=1
]
node[
    anybutton,
    pos=0.65
]
{3C} (Next Channel Mode from ON.east);

% Tint Ramping from ON
\node (Tint Ramping from ON)
at (current page.west)[
    anyconfig,
    below=0.25cm of Next Channel Mode from ON.south west,
    anchor=north west
]
{
    \firstline{Tint Ramping}
    If this channel mode can
};

\draw (ON.west) edge[
    ->,
    anyline,
    out=180,
    in=0,
    looseness=1
]
node[
    anybutton,
    pos=0.6
]
{3H} (Tint Ramping from ON.east);

% Momentary Turbo 3H from ON
\node (Momentary Turbo 3H from ON)[
    advancedconfig,
    below=0.25cm of Tint Ramping from ON.south west,
    anchor=north west
]
{
    \firstline{Momentary Turbo}
    If no tint ramping
};

\draw (ON.west) edge[
    ->,
    advancedline momentary,
    out=180,
    in=0,
    looseness=0.8
]
node[
    advancedbutton,
    pos=0.667
]
{3H} (Momentary Turbo 3H from ON.east);

% Momentary Turbo 4H from ON
\node (Momentary Turbo 4H from ON)[
    advancedconfig,
    below=0.25cm of Momentary Turbo 3H from ON.south west,
    anchor=north west
]
{
    \firstline{Momentary Turbo}
    On multi-channel lights
};

\draw (ON.west) edge[
    ->,
    advancedline momentary,
    out=180,
    in=0,
    looseness=0.8
]
node[
    advancedbutton,
    pos=0.71
]
{4H} (Momentary Turbo 4H from ON.east);

% Sunset Timer from ON
\node (Sunset Timer from ON)[
    advancedconfig,
    above right=1.2cm and 2.2cm of ON.center,
    anchor=south
]
{
    \firstline{Sunset Timer}
    1 blink = 5 minutes
};
\draw (ON.north) edge[
    ->,
    advancedline,
    out=90,
    in=180,
    looseness=1
]
node[
    advancedbutton,
    pos=0.65
]
{5H} (Sunset Timer from ON.west);

% Ramp Config from ON %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Ramp Config from ON)
at (current page.north west)[
    advancedtable,
    xshift=1cm,
    yshift=-1cm,
    anchor=north west
]
{
    \begin{tabular}{m{0.35cm} l}
        \multicolumn{2}{l}{
            \thead{Ramp Config}
        }\\
        \multicolumn{2}{l}{
            \thead{\footnotesize Smooth Ramp}
        }\\
        {1} & \makecell{
            Floor: nC = n of 150
        }\\
        {2} & \makecell{
            Ceiling: nC = 151 \char"2212{} n
        }\\
        {3} & \makecell{
            Speed\inherited{}: 1C (full speed)\\
            to 4C (quarter speed)
        }\\
        \multicolumn{2}{l}{
            \thead{\footnotesize Stepped Ramp}
        }\\
        {1} & \makecell{
            Floor: nC = n of 150
        }\\
        {2} & \makecell{
            Ceiling: nC = 151 \char"2212{} n
        }\\
        {3} & \makecell{
            Step count: 1\textendash{}150C
        }
    \end{tabular}
};

\draw[
    ->,
    advancedline
]
(ON.north) to[
    out=90,
    in=280,
    looseness=1.3
]
+(-2.83,3.15) to[
    out=100,
    in=275,
    looseness=0.9
]
node[
    advancedbutton,
    pos=0.6
] 
{7H} +(-2.95,4.9) to[
    out=95,
    in=320,
    looseness=0.9
] (Ramp Config from ON.300);

% Channel Mode Config from ON
\node (Channel Mode Config from ON)[
    advancedtable,
    above=0.5cm of Next Channel Mode from ON.north west,
    anchor=south west
]
{
    \begin{tabular}{m{0.35cm} l}
        \multicolumn{2}{l}{
            \thead{Channel Mode\\
            Config\inherited{}}
        }\\
        {n} & \makecell{
            n\textsuperscript{th} channel mode
        }\\
        {} & \makecell{
            0C = Disable\\
            1C = Enable
        }\\
        \multicolumn{2}{l}{
            \thead{\firstlinetable{Typical sequence for}
            \onelinetable{dual-channel lights}}
        }\\
        {1} & \makecell{
            Channel 1
        }\\
        {2} & \makecell{
            Channel 2
        }\\
        {3} & \makecell{
            50/50
        }\\
        {4} & \makecell{
            Tint Ramp
        }\\
        {5} & \makecell{
            Auto-tint
        }\\
        {6+} & \makecell{
            Aux LED Channels
        }
    \end{tabular}
};

\draw (ON.north) edge[
    ->,
    advancedline,
    out=90,
    in=320,
    looseness=1.2
]
node[
    advancedbutton,
    pos=0.69,
    label={
        [align=left, xshift=0cm, yshift=0cm]below:{
            \begin{tabular}{l}
                9H from any mode\\
                unless overridden
            \end{tabular}
        }
   }
]
{9H} (Channel Mode Config from ON.316);

% Ramp Extras Config from ON
\node (Ramp Extras Config from ON)[
    advancedtable,
    right=0.8cm of Ramp Config from ON.north east,
    anchor=north west
]
{
    \begin{tabular}{m{0.35cm} l}
        \multicolumn{2}{l}{
            \thead{Ramp Extras Config}
        }\\
        {1} & \makecell{
            Disable manual memory\inherited{}
        }\\
        {} & \makecell{
            1+C
        }\\
        {2} & \makecell{
            Manual memory timer\inherited{}
        }\\
        {} & \makecell{
            0C = Disable\\
            nC = n minutes
        }\\
        {3} & \makecell{
            Moon style (1H from Off)\inherited{}
        }\\
        {} & \makecell{
            0C = Ramp up after moon\\
            1C = Stay at floor level
        }\\
        {4} & \makecell{
            Advanced UI's turbo style\\
            (2C from On/Ramp)
        }\\
        {} & \makecell{
            0C = Ceiling only, no turbo\\
            1C = Turbo\\
            2C = Ceiling, or turbo if\\
            ramped up to ceiling first
        }\\
        {5} & \makecell{
            Smooth Steps\inherited{}
        }\\
        {} & \makecell{
            0C = Disable\\
            1C = Enable
        }\\
        \multicolumn{2}{l}{
            \thead{\firstlinetable{Types of brightness memory}
            \onelinetable{(1C from Off)}}
        }\\
        \multicolumn{2}{l}{
            \makecell{Automatic: last-ramped\\
            Manual: user's saved\\
            Hybrid: manual after n minutes}
        }
    \end{tabular}
};

\draw (ON.north) edge[
    ->,
    advancedline,
    out=90,
    in=270,
    looseness=1.5
]
node[
    advancedbutton,
    pos=0.8
]
{10H} (Ramp Extras Config from ON.273);

% Manual Memory from ON
\node (Manual Memory from ON)[
    advancedconfig,
    above right=0.6cm and 0.4cm of Ramp Extras Config from ON.south east,
    anchor=south west
]
{
    \firstline{Manual Memory\inherited{}}
    Activate, and save\\
    current brightness and\\
    current channel mode\vphantom{y}
};

\draw (ON.north) edge[
    ->,
    advancedline,
    out=90,
    in=250,
    looseness=1.5
]
node[
    advancedbutton,
    pos=0.77
]
{10C} (Manual Memory from ON.222);

% Simple UI Config from OFF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Simple UI Config from OFF)[
    advancedtable,
    right=0.8cm of Ramp Extras Config from ON.north east,
    anchor=north west
]
{
    \begin{tabular}{m{0.35cm} l}
        \multicolumn{2}{l}{
            \thead{Simple UI Config}
        }\\
        {1} & \makecell{
            Floor: nC = n of 150
        }\\
        {2} & \makecell{
            Ceiling: nC = 151 \char"2212{} n
        }\\
        {3} & \makecell{
            Step count: 1\textendash{}150C
        }\\
        {4} & \makecell{
            Simple UI's turbo style\\
            (2C from On/Ramp)
        }\\
        {} & \makecell{
            0C = Ceiling only, no turbo\\
            1C = Turbo\\
            2C = Ceiling, or turbo if\\
            ramped up to ceiling first
        }
    \end{tabular}
};

\draw (OFF.north) edge[
    ->,
    advancedline,
    out=90,
    in=270,
    looseness=1.5
]
node[
    advancedbutton,
    pos=0.9
]
{10H} (Simple UI Config from OFF.302);

% Misc Config from OFF
\node (Misc Config from OFF)[
    advancedtable,
    right=0.8cm of Simple UI Config from OFF.north east,
    anchor=north west
]
{
    \begin{tabular}{m{0.35cm} l}
        \multicolumn{2}{l}{
            \thead{Misc Config\inherited{}}
        }\\
        \multicolumn{2}{l}{
            \onelinetable{Hardware-specific}
        }\\[0.5ex]
        {1} & \makecell{
            Tint Ramp style
        }\\
        {} & \makecell{
            0C = Smooth ramp\\
            1C = Middle tint only\\
            2C = Channel toggle\\
            3+C = Stepped ramp\\
            with 3+ steps
        }\\
        {2} & \makecell{
            Jump Start level
        }\\
        {} & \makecell{
            1\textendash{}150C (usually\\
            between 20 and 50)
        }
    \end{tabular}
};

\draw (OFF.north) edge[
    ->,
    advancedline,
    out=90,
    in=238,
    looseness=1
]
node[
    advancedbutton,
    pos=0.83
]
{9H} (Misc Config from OFF.245);

% Momentary Moon from Lockout %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Momentary Moon from Lockout)[
    anyconfig,
    below right=1.2cm and 3.2cm of Lockout.center,
    anchor=north
]
{
    \firstline{Momentary Moon}
    Lowest floor of\\
    smooth vs stepped
};

\draw (Lockout.south) edge[
    ->,
    anyline momentary,
    out=270,
    in=180,
    looseness=1
]
node[
    anybutton,
    pos=0.715
]
{1H} (Momentary Moon from Lockout.west);

% Momentary Low from Lockout
\node (Momentary Low from Lockout)[
    anyconfig,
    below=0.25cm of Momentary Moon from Lockout.south west,
    anchor=north west
]
{
    \firstline{Momentary Low}
    Highest floor of\\
    smooth vs stepped, or\\
    manual memory if set
};

\draw (Lockout.south) edge[
    ->,
    anyline momentary,
    out=270,
    in=180,
    looseness=1
]
node[
    anybutton,
    pos=0.73
]
{2H} (Momentary Low from Lockout.west);

% Next Channel Mode from Lockout
\node (Next Channel Mode from Lockout)[
    anyconfig,
    below=0.25cm of Momentary Low from Lockout.south west,
    anchor=north west
]
{\oneline{Next Channel Mode}};

\draw (Lockout.south) edge[
    ->,
    anyline,
    out=270,
    in=180,
    looseness=1
]
node[
    anybutton,
    pos=0.745
]
{3H} (Next Channel Mode from Lockout.west);

% Aux LED Color from OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{scope}[on background layer]
    \node (Aux LED Color from OFF right)[
        advancedconfig,
        above right=1.2cm and 3.2cm of Lockout.center,
        anchor=south
    ]
    {
        \firstline{OFF Aux LED Color\inherited{}}
        Red \char"2192{} Yellow \char"2192{} Green \char"2192{}
        Cyan \char"2192{}\\
        Blue \char"2192{} Purple \char"2192{} White \char"2192{}\\
        Disco \char"2192{} Rainbow \char"2192{}
        \voltageboxred{V\vphantom{Voltage}}%
        \voltagebox[yellow]{o\vphantom{Voltage}}%
        \voltagebox[green]{lt\vphantom{Voltage}}%
        \voltagebox[cyan]{a\vphantom{Voltage}}%
        \voltagebox[blue]{g\vphantom{Voltage}}%
        \voltageboxpurple{e\vphantom{Voltage}}
    };
\end{scope}

\draw (OFF right.north) edge[
    ->,
    advancedline,
    out=90,
    in=0,
    looseness=1.1
]
node[
    advancedbutton,
    pos=0.65
]
{7H} (Aux LED Color from OFF right.east);

% Aux LED Pattern from OFF right
\node (Aux LED Pattern from OFF right)[
    advancedconfig,
    above=0.25cm of Aux LED Color from OFF right.north west,
    anchor=south west
]
{
    \firstline{OFF Aux LED Pattern\inherited{}}
    Off \char"2192{} Low \char"2192{} High \char"2192{} Blinking
};

\draw (OFF right.north) edge[
    ->,
    advancedline,
    out=90,
    in=0,
    looseness=1.1
]
node[
    advancedbutton,
    pos=0.7
]
{7C} (Aux LED Pattern from OFF right.east);

% Aux LED Color from Lockout
\begin{scope}[on background layer]
    \node (Aux LED Color from Lockout)[
        advancedconfig,
        above=0.25cm of Aux LED Pattern from OFF right.north west,
        anchor=south west
    ]
    {
        \firstline{Lockout Aux LED Color\inherited{}}
        Red \char"2192{} Yellow \char"2192{} Green \char"2192{}
        Cyan \char"2192{}\\
        Blue \char"2192{} Purple \char"2192{} White \char"2192{}\\
        Disco \char"2192{} Rainbow \char"2192{}
        \voltageboxred{V\vphantom{Voltage}}%
        \voltagebox[yellow]{o\vphantom{Voltage}}%
        \voltagebox[green]{lt\vphantom{Voltage}}%
        \voltagebox[cyan]{a\vphantom{Voltage}}%
        \voltagebox[blue]{g\vphantom{Voltage}}%
        \voltageboxpurple{e\vphantom{Voltage}}
    };
\end{scope}

\draw (Lockout.north) edge[
    ->,
    advancedline,
    out=90,
    in=180,
    looseness=0.8
]
node[
    advancedbutton,
    pos=0.65
]
{7H} (Aux LED Color from Lockout.west);

% Aux LED Pattern from Lockout
\node (Aux LED Pattern from Lockout)[
    advancedconfig,
    above=0.25cm of Aux LED Color from Lockout.north west,
    anchor=south west
]
{
    \firstline{Lockout Aux LED Pattern\inherited{}}
    Off \char"2192{} Low \char"2192{} High \char"2192{} Blinking
};

\draw (Lockout.north) edge[
    ->,
    advancedline,
    out=90,
    in=180,
    looseness=0.8
]
node[
    advancedbutton,
    pos=0.7
]
{7C} (Aux LED Pattern from Lockout.west);

% Auto-lock Config from Lockout
\node (Auto-lock Config from Lockout)[
    advancedconfig,
    left=1.8cm of Aux LED Pattern from Lockout.north west,
    anchor=north east
]
{
    \firstline{Auto-lock\inherited{}}
    0C = Disable\\
    nC = n minutes
};

\draw (Lockout.north) edge[
    ->,
    advancedline,
    out=90,
    in=300,
    looseness=0.7
]
node[
    advancedbutton,
    pos=0.82
]
{10H} (Auto-lock Config from Lockout.south);

% Factory Reset from OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Factory Reset from OFF right)
at (current page.south east)[
    anyconfig,
    anchor=south east,
    xshift=-1cm,
    yshift=1cm
]
{
    \firstline{Factory Reset}
    Physical Reset:\\
    reconnect power\\
    while holding button\\
    for about 4s
    \spacingv
    Simple UI is enabled\\
    after each factory reset.
};

\draw (OFF right.south) edge[
    ->,
    anyline,
    out=270,
    in=135,
    looseness=0.55
]
node[
    anybutton,
    pos=0.77,
    label={
        [align=left, xshift=-0.05cm, yshift=-0.025cm]right:{
            \begin{tabular}{l}
                Keep holding\\
                for about 4s
            \end{tabular}
        }
    }
]
{13H} (Factory Reset from OFF right.west);

% Version Check from OFF right
\node (Version Check from OFF right)[
    anyconfig,
    above=1cm of Factory Reset from OFF right.north east,
    anchor=south east
]
{
    \firstline{Version Check}
    MODEL-YYYY-MM-DD-\\
    SINCE-DIRTY
    \spacingv
    SINCE and DIRTY\\
    may be omitted.
};

\draw (OFF right.south) edge[
    ->,
    anyline,
    out=270,
    in=135,
    looseness=0.6
]
node[
    anybutton,
    pos=0.75
]
{15+C} (Version Check from OFF right.west);

% Advanced UI switch from OFF right %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Advanced UI switch from OFF right)
at (current page.east)[
    advancedUI,
    anchor=north east,
    xshift=-1cm,
    yshift=-2.4cm
]
{Advanced UI};

\draw (OFF right.east) edge[
    ->,
    simpleline,
    out=0,
    in=90,
    looseness=1.2
]
node[
    simplebutton,
    pos=0.68
]
{10H} (Advanced UI switch from OFF right.north);

% Simple UI switch from OFF right
\node (Simple UI switch from OFF right)
at (current page.east)[
    simpleUI,
    anchor=south east,
    xshift=-1cm,
    yshift=2.4cm
]
{Simple UI};

\draw (OFF right.east) edge[
    ->,
    advancedline,
    out=0,
    in=270,
    looseness=1.2
]
node[
    advancedbutton,
    pos=0.7
]
{10C} (Simple UI switch from OFF right.south);

% Simple UI switch extra node Extended Simple UI
\node (Simple UI switch extra node Extended Simple UI)[
    above=0.2cm of Simple UI switch from OFF right.north east,
    extendedsimpleUI,
    anchor=south east
]
{\normalsize Extended Simple UI};

% Extended Simple UI description
\node (Extended Simple UI description)[
    above=0.05cm of Simple UI switch extra node Extended Simple UI.north east,
    anchor=south east,
    inner xsep=0.05cm,
    inner ysep=0cm,
    align=right
]
{
    On some lights; typically enables\\
    toggle ramp style, sunset timer,\\
    access to strobe / mood modes,\\
    and aux LED pattern and color.
};

% Anduril 2 UI %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (Anduril 2 UI)
at (current page.north east)[
    andurilinfo,
    anchor=north east,
    xshift=-1cm,
    yshift=-1cm
]
{
    \Huge\textbf{Andúril 2 UI}\\[3.25ex]
    \normalsize Andúril 2 Release 2024-04-20\\[1.0ex]
    \normalsize Diagram Release 41\\[1.5ex]
    Diagram Repository:\\
    https://github.com/dirtydancing/\\
    anduril-tikz-diagram
    \spacingv
    ToyKeeper's Andúril User Manual:\\
    https://toykeeper.net/anduril/manual
};

% Aux LED Color for Voltage
\begin{scope}[on background layer]
    \node (Aux LED Color for Voltage)[
        voltagecolorinfo,
        below=0.25cm of Anduril 2 UI.south east,
        anchor=north east
    ]
    {
        \oneline{Aux LED Color for Voltage}
        \spacingv
        \voltageboxred{R-2.9,\vphantom{Voltage,Ú}}%
        \voltagebox[yellow]{\hspace{0.013cm}Y-3.3,\vphantom{Voltage,Ú}}%
        \voltagebox[green]{\hspace{0.013cm}G-3.5,\vphantom{Voltage,Ú}}%
        \voltagebox[cyan]{\hspace{0.013cm}C-3.7,\vphantom{Voltage,Ú}}%
        \voltagebox[blue]{\hspace{0.013cm}B-3.9,\vphantom{Voltage,Ú}}%
        \voltageboxpurple{\hspace{0.013cm}P-4.1V\vphantom{Voltage,Ú}}\\[1.5ex]
        Single-color aux: fast-blink 3.3\textendash{}2.9V
    };
\end{scope}

% Button Presses
\node (Button Presses)[
    buttonpressesinfo,
    left=0.8cm of Anduril 2 UI.north west,
    anchor=north east
]
{
    {}\\[0.2ex] % for vertical alignment
    \firstline{Button Presses}
    1C: Click\\
    1H: Hold\\
    2C: Click, Click\\
    2H: Click, Hold\\
    3C: Click, Click, Click\\
    3H: Click, Click, Hold
    \spacingv
    In a config menu, release\\
    button after the desired\\
    number of blinks; when\\
    entering a value, 1H = 10C
};

% Legend
\node (Legend basic use text)[
    legendlayout,
    below left=0.1cm and 0.9cm of Button Presses.north west,
    anchor=north east
]
{All the user needs to know for basic use\vphantom{y}};

\node (Legend basic use picture)[
    legendlayout,
    left=0.22cm of Legend basic use text.west,
    anchor=east
]
{};

\draw (Legend basic use picture.west) edge[
    -,
    anyline basic use legend,
    out=0,
    in=180
]
node[
    anybutton basic use,
    pos=0.5
]
{\footnotesize 1C} (Legend basic use picture.east);

\node (Legend Simple and Advanced text)[
    legendlayout,
    below=0.1cm of Legend basic use text.south west,
    anchor=north west
]
{Simple UI and Advanced UI function};

\node (Legend Simple and Advanced picture)[
    legendlayout,
    left=0.22cm of Legend Simple and Advanced text.west,
    anchor=east
]
{};

\draw (Legend Simple and Advanced picture.west) edge[
    -,
    anyline legend,
    out=0,
    in=180
]
node[
    anybutton,
    pos=0.5
]
{\footnotesize 1C} (Legend Simple and Advanced picture.east);

\node (Legend Simple only text)[
    legendlayout,
    below=0.1cm of Legend Simple and Advanced text.south west,
    anchor=north west
]
{Simple UI function only};

\node (Legend Simple only picture)[
    legendlayout,
    left=0.22cm of Legend Simple only text.west,
    anchor=east
]
{};

\draw (Legend Simple only picture.west) edge[
    -,
    simpleline legend,
    out=0,
    in=180
]
node[
    simplebutton,
    pos=0.5
]
{\footnotesize 1C} (Legend Simple only picture.east);

\node (Legend Advanced only text)[
    legendlayout,
    below=0.1cm of Legend Simple only text.south west,
    anchor=north west
]
{Advanced UI function only};

\node (Legend Advanced only picture)[
    legendlayout,
    left=0.22cm of Legend Advanced only text.west,
    anchor=east
]
{};

\draw (Legend Advanced only picture.west) edge[
    -,
    advancedline legend,
    out=0,
    in=180
]
node[
    advancedbutton,
    pos=0.5
]
{\footnotesize 1C} (Legend Advanced only picture.east);

\node (Legend Continuous effect text)[
    legendlayout,
    below=0.1cm of Legend Advanced only text.south west,
    anchor=north west
]
{Continuous effect\vphantom{y}};

\node (Legend Continuous effect picture)[
    legendlayout,
    left=0.22cm of Legend Continuous effect text.west,
    anchor=east
]
{};

\draw (Legend Continuous effect picture.west) edge[
    -,
    anyline legend,
    out=0,
    in=180
]
(Legend Continuous effect picture.east);

\node (Legend Momentary effect text)[
    legendlayout,
    below=0.1cm of Legend Continuous effect text.south west,
    anchor=north west
]
{Momentary effect};

\node (Legend Momentary effect picture)[
    legendlayout,
    left=0.22cm of Legend Momentary effect text.west,
    anchor=east
]
{};

\draw (Legend Momentary effect picture.west) edge[
    -,
    anyline momentary legend,
    out=0,
    in=180
]
(Legend Momentary effect picture.east);

\node (Legend Inherited by Simple text)[
    legendlayout,
    below=0.1cm of Legend Momentary effect text.south west,
    anchor=north west
]
{Inherited by Simple UI};

\node (Legend Inherited by Simple picture)[
    legendlayout,
    left=0.22cm of Legend Inherited by Simple text.west,
    anchor=east
]
{\normalsize\textbf{\inherited{}}};

% Legend fit
\begin{scope}[on background layer]
    \node (Legend fit)[
        legendfit,
        yshift=-0.2pt, % 1/2 line thickness for outer alignment
        fit=(Legend basic use text)
        (Legend basic use picture)
        (Legend Simple and Advanced text)
        (Legend Simple and Advanced picture)
        (Legend Simple only text)
        (Legend Simple only picture)
        (Legend Advanced only text)
        (Legend Advanced only picture)
        (Legend Continuous effect text)
        (Legend Continuous effect picture)
        (Legend Momentary effect text)
        (Legend Momentary effect picture)
        (Legend Inherited by Simple text)
        (Legend Inherited by Simple picture)
    ]
    {};
\end{scope}

\end{tikzpicture}

\end{document}
